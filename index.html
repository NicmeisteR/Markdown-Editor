<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
    <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'self'"> -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InfoSlips Markdown CMS</title>
  <link rel="stylesheet" href="./simple.css">
  <link rel="stylesheet" href="./style.css">
  <script src="https://kit.fontawesome.com/468c9447d4.js"></script>
  <!-- <link rel="stylesheet" href="node_modules/simplemde/dist/simplemde.min.css">
  <script src="node_modules/simplemde/dist/simplemde.min.js"></script> -->
  <script src="./simple.js"></script>
</head>

<body>
  <textarea id="MyID" placeholder="Start typing content here:"></textarea>
  <script>
    // Most options demonstrate the non-default behavior
    var simplemde = new SimpleMDE({
      autofocus: true,
      autosave: {
        enabled: true,
        uniqueId: "MyUniqueID",
        delay: 1000,
      },
      blockStyles: {
        bold: "__",
        italic: "_"
      },
      element: document.getElementById("MyID"),
      forceSync: true,
      hideIcons: ["guide", "heading"],
      indentWithTabs: false,
      // initialValue: "Start typing content here:",
      insertTexts: {
        horizontalRule: ["", "\n\n-----\n\n"],
        image: ["![](http://", ")"],
        link: ["[", "](http://)"],
        table: ["", "\n\n| Column 1 | Column 2 | Column 3 |\n| -------- | -------- | -------- |\n| Text     | Text      | Text     |\n\n"],
      },
      lineWrapping: false,
      parsingConfig: {
        allowAtxHeaderWithoutSpace: true,
        strikethrough: false,
        underscoresBreakWords: true,
      },
      placeholder: "Type here...",
      previewRender: function (plainText) {
        return customMarkdownParser(plainText); // Returns HTML from a custom parser
      },
      previewRender: function (plainText, preview) { // Async method
        setTimeout(function () {
          preview.innerHTML = customMarkdownParser(plainText);
        }, 250);

        return "Loading...";
      },
      promptURLs: true,
      renderingConfig: {
        singleLineBreaks: false,
        codeSyntaxHighlighting: true,
      },
      shortcuts: {
        drawTable: "Cmd-Alt-T"
      },
      showIcons: ["code", "table"],
      spellChecker: false,
      status: false,
      status: ["autosave", "lines", "words", "cursor"], // Optional usage
      status: ["autosave", "lines", "words", "cursor", {
        className: "keystrokes",
        defaultValue: function (el) {
          this.keystrokes = 0;
          el.innerHTML = "0 Keystrokes";
        },
        onUpdate: function (el) {
          el.innerHTML = ++this.keystrokes + " Keystrokes";
        }
      }], // Another optional usage, with a custom status bar item that counts keystrokes
      styleSelectedText: false,
      tabSize: 4,
      toolbar: [
        "bold",
        "italic",
        "strikethrough",
        "|",
        "heading-1",
        "heading-2",
        "heading-3",
        "heading-bigger",
        "heading-smaller",
        "|",
        "quote",
        "unordered-list",
        "ordered-list",
        "|",
        "link",
        "image",
        "table",
        "|",
        // "preview",
        // "side-by-side",
        "fullscreen",
        "|",
        "guide"
      ],
      toolbarTips: true,
    });
  </script>

<div class="downloadBar">
  <form>
     <label>
        <i class="fas fa-file-download downloadIcon" onclick="saveTextAsFile(MyID.value,`${fileName.value}.md`)"></i>
     </label>
     <input type="text" id="fileName" placeholder="File Name">
  </form>
 </div>
 <!-- <button onclick="saveTextAsFile(MyID.value,`${fileName.value}.md`)">Download</button> -->

  <script>
       function saveTextAsFile(textToWrite, fileNameToSaveAs)
    {
    	var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'}); 
    	var downloadLink = document.createElement("a");
    	downloadLink.download = fileNameToSaveAs;
    	downloadLink.innerHTML = "Download File";
    	if (window.webkitURL != null)
    	{
    		// Chrome allows the link to be clicked
    		// without actually adding it to the DOM.
    		downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
    	}
    	else
    	{
    		// Firefox requires the link to be added to the DOM
    		// before it can be clicked.
    		downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
    		downloadLink.onclick = destroyClickedElement;
    		downloadLink.style.display = "none";
    		document.body.appendChild(downloadLink);
    	}
    
    	downloadLink.click();
    }
  </script>

</body>

</html>